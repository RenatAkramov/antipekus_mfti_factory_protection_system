# Antipekus_mfti_factory_protection_system — доступ к двери по кнопке / PIN-коду / FaceID (ESP32 + ESP32-CAM + Server + CompareFace)

Проект системы контроля доступа к двери на базе двух микроконтроллеров:  
- ESP32 (Door Controller) — управляет реле электромагнита, читает клавиатуру, кнопки.  
- ESP32-CAM (FaceID Client) — делает фото, отправляет на сервер, получает результат распознавания и дает сигнал на ESP32 для открытия двери.  

Распознавание лиц реализовано через сервер-посредник, который принимает фото от ESP32-CAM и проксирует его в Docker-контейнер open-source проекта CompareFace. CompareFace возвращает JSON с результатом сравнения, сервер/ESP32-CAM принимает решение и при успешном совпадении подает сигнал на открытие.

---

## Возможности

- ✅ Открытие двери по кнопке (обычно “выход” изнутри)
- ✅ Открытие двери по PIN-коду с клавиатуры (обрабатывает ESP32 без камеры)
- ✅ Открытие двери по FaceID (ESP32-CAM → Server → CompareFace → сигнал на ESP32)
- ✅ Разделение логики на два устройства (удобно по питанию/размещению/стабильности)
- ✅ Гибкая настройка: пины, таймауты, уровни сигнала, пороги совпадения

---

## Архитектура (как это работает)

### Поток 1 — Кнопка / PIN (ESP32 Door Controller)
1. Пользователь нажимает кнопку или вводит PIN на клавиатуре.
2. ESP32 проверяет правило доступа.
3. При успехе включает реле на заданное время (например 500–1500 мс) → электромагнит отпускает дверь.

### Поток 2 — FaceID (ESP32-CAM + Server + CompareFace)
1. ESP32-CAM делает фото (JPEG) и отправляет на сервер по Wi-Fi.
2. Сервер передает фото в контейнер CompareFace.
3. CompareFace возвращает результат в JSON (совпало / не совпало).
4. ESP32-CAM принимает решение:
   - если “человек есть в базе” → ESP32-CAM подает сигнал на вход ESP32 (Door Controller)
5. ESP32 получает сигнал и открывает дверь.

---

## Железо

Минимальный набор:
- 1× ESP32 (например DevKit)
- 1× ESP32-CAM (AI Thinker или аналог)
- 1× Реле-модуль (под ваши токи/напряжения замка)
- 1× Электромагнитный замок/защелка
- 1× Клавиатура (обычно 4×4 или 4×3)
- 2× Кнопки (например “Exit” и “Service/Reset” — зависит от проекта)
- Блок питания под замок + стабилизатор/понижайка под 5V/3.3V для ESP


